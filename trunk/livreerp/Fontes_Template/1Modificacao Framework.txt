;
---------- Defaults 
;
create default [dbo].[Kernel_cur_Zero] as 0
;
create default [dbo].[Kernel_str_Data] as Getdate()
;
create default [dbo].[Kernel_str_Status] as 'F'
;
---------- Tipo de Campos
;
EXEC sp_addtype N'dt_data', N'datetime', N'not null'
;
EXEC sp_addtype N'IMG_BLOG', N'image', N'not null'
;
EXEC sp_addtype N'INT_CODIGO', N'int', N'not null'
;
EXEC sp_addtype N'STR_DESCRICAO', N'varchar(100)', N'not null'
;
EXEC sp_addtype N'STR_EMAIL', N'varchar(50)', N'not null'
;
EXEC sp_addtype N'STR_OBSERVACAO', N'varchar(255)', N'not null'
;
EXEC sp_addtype N'STR_STATUS', N'char(1)', N'not null'
;
CREATE TYPE [dbo].[VL_VALOR2] FROM [decimal](15, 2) NOT NULL
;
EXEC sp_bindefault N'[dbo].[Kernel_str_Status]', N'[STR_STATUS]'
;
EXEC sp_bindefault N'[dbo].[Kernel_str_Status]', N'[Kernel_str_Data]'
;
EXEC sys.sp_bindefault @defname=N'[dbo].[Kernel_cur_Zero]', @objname=N'[dbo].[VL_VALOR2]' , @futureonly='futureonly'
;
---------- Tabelas
;
CREATE TABLE [dbo].[TLS_COLUNA](
	[CLN_COLUNA] [dbo].[INT_CODIGO] NOT NULL,
	[CLN_NOME] [dbo].[STR_DESCRICAO] NULL,
	[TLA_TELA] [dbo].[INT_CODIGO] NULL,
	[CLN_SOMA] [dbo].[STR_STATUS] NULL,
	[CLN_FILTRA] [dbo].[STR_STATUS] NULL,
	[CLN_TAMANHO] [int] NULL,
	[CLN_ORDEM] [int] NULL,
	[CLN_CHAVE] [dbo].[STR_STATUS] NULL,
	[CLN_CAPTION] [varchar](100) NULL,
	[SMA_SOMA] [dbo].[INT_CODIGO] NULL,
	[CLN_NOME_AMIGAVEL] [nchar](10) NULL
) ON [PRIMARY]
;
CREATE TABLE [TLS_SOMA](
	[SMA_SOMA] [INT_CODIGO] NOT NULL,
	[SMA_NOME] [STR_DESCRICAO] NULL
)
;
CREATE TABLE [TLS_TELA](
	[TLA_TELA] [INT_CODIGO] NOT NULL,
	[TLA_NOME] [STR_DESCRICAO] NULL,
	[TLA_TITULO] [STR_DESCRICAO] NULL,
	[TLA_CLASSE] [STR_DESCRICAO] NULL
)
;
CREATE TABLE [LCT_PARAMETRO](
	[PMU_QTD_TENTATIVAS] [INT_CODIGO] NULL
)
;
CREATE TABLE  [USU_USUARIO](
	[USU_USUARIO]  [INT_CODIGO] NOT NULL,
	[USU_NOME]  [STR_DESCRICAO] NULL,
	[USU_EMAIL]  [STR_EMAIL] NULL,
	[USU_STS_ATIVO]  [STR_STATUS] NULL,
	[FRL_PERFIL]  [INT_CODIGO] NULL,
	[USU_DT_EXPIRA]  [DT_DATA] NULL,
	[USU_STS_ADMIN]  [STR_STATUS] NULL,
	[USU_SENHA_EXPIRA]  [STR_STATUS] NULL,
	[USU_SENHA]  [STR_DESCRICAO] NULL,
	[USU_LOGIN]  [STR_DESCRICAO] NULL
)
;
CREATE TABLE USU_PERFIL (
        FRL_PERFIL INT NOT NULL,
        FRL_NOMEPERFIL VARCHAR(150) NULL
)
;
CREATE TABLE ADI_AUDITORIA (
  ADT_AUDITORIA INT_CODIGO,
  ADT_TIPO INTEGER,
  ADT_USUARIO_CADASTRO INTEGER,
  ADT_DATA_CADASTRO dt_data,
  ADT_MOTIVO STR_OBSERVACAO,
  ADT_IP STR_OBSERVACAO,
  ADT_TABELA STR_DESCRICAO,
  ADT_CODIGO_TABELA INT_CODIGO)
;
CREATE TABLE ADI_AUDITORIAITM (
  ADI_AUDITORIAITM INT_CODIGO NOT NULL,
  ADT_AUDITORIA INT_CODIGO,
  ADI_CAMPO STR_DESCRICAO,
  ADI_NOVO_VALOR STR_DESCRICAO,
  ADI_ANTIGO_VALOR STR_DESCRICAO)
;
---------- Campos Novos
;
ALTER TABLE TLS_TELA ADD TLA_TABELA STR_DESCRICAO
;
EXEC sp_bindefault N'[dbo].[Kernel_str_Status]', N'[USU_USUARIO].[USU_SENHA_EXPIRA]'
;
EXEC sp_bindefault N'[dbo].[Kernel_str_Status]', N'[USU_USUARIO].[USU_STS_ADMIN]'
;
---------- Views
;
drop VIEW [VW_LST_COLUNAS]
;
CREATE VIEW [VW_LST_COLUNAS]
AS
SELECT
  T.TLA_TELA, T.TLA_NOME, T.TLA_TITULO, T.TLA_CLASSE,
  C.CLN_COLUNA, C.CLN_NOME, C.CLN_SOMA, C.CLN_FILTRA, C.CLN_TAMANHO,
  C.CLN_ORDEM, C.CLN_CHAVE, C.CLN_CAPTION, S.SMA_NOME, S.SMA_SOMA, C.CLN_NOME_AMIGAVEL
FROM TLS_TELA T
INNER JOIN TLS_COLUNA C ON T.TLA_TELA=C.TLA_TELA
INNER JOIN TLS_SOMA S ON S.SMA_SOMA=C.SMA_SOMA
;
DROP VIEW VAP_VW_LST_TELAS
;
CREATE VIEW VAP_VW_LST_TELAS
AS
SELECT
  T.TLA_TELA, T.TLA_NOME, T.TLA_TITULO, T.TLA_CLASSE
FROM TLS_TELA T
;
DROP VIEW VAP_VW_LCT_TIPO
;
CREATE VIEW VAP_VW_LCT_TIPO
AS
SELECT TIP_TIPO, TIP_DESCRICAO FROM LCT_TIPO
;
---------- Inserts Framework
;
delete from TLS_SOMA	
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (1,'SKCount')
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (2,'SkSum')
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (3,'skMax')
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (4,'skMin')
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (5,'skNone')
;
INSERT INTO TLS_SOMA (SMA_SOMA, SMA_NOME)  VALUES (6,'skAverage')
;
INSERT INTO USU_USUARIO (USU_USUARIO, USU_NOME, USU_EMAIL, USU_STS_ATIVO, PRF_PERFIL, USU_DT_EXPIRA, USU_STS_ADMIN,
USU_SENHA_EXPIRA, USU_SENHA, USU_LOGIN ) VALUES
(1,'ADMIN','','F',1,GETDATE(),'T','F','ADMIN','ADMIN')
;


